# Розробка

Ця стаття документації призначена для розробників, які хочуть розробляти нові плагіни, покращувати існуючі або відлагоджувати їх.

## Rete CLI {#rete-cli}

Rete CLI — це інструмент для збірки з вбудованою підтримкою TypeScript і ESLint разом із попередньо визначеними правилами. Крім того, він включає Jest. Ці функції спрощують створення нових плагінів без необхідності налаштовувати власне середовище для збірки, лінтингу та тестування.

Функція збірки базується на Rollup і постачається з попередньо налаштованими стилями Babel для підтримки TypeScript.

### Встановлення {#install-rete-cli}

```bash
npm i -g rete-cli@next
```

### Збірка проекту {#build-rete-cli}

Першим кроком є створення файлу конфігурації під назвою `rete.config.ts`

```ts
import { ReteOptions } from 'rete-cli'

export default<ReteOptions>{
  input: 'src/index.ts', // шлях до вхідного скрипту
  name: 'Namespace' // простір імен для UMD бандлів
}
```

Виконайте команду

```bash
rete build --config rete.config.ts
```

Створена директорія `dist` готова до публікації та містить усі необхідні бандли, визначення типів, файли README.md і package.json із відповідними шляхами.

Параметр `--watch` можна використовувати для запуску автоматичного створення проекту після збереження, тоді як параметр `--outputs` дозволяє вказати кілька вихідних шляхів, розділених комами, для місця призначення збірки.

### Створіть розширену конфігурацію {#create-config-rete-cli}

Давайте розглянемо кілька підтримуваних параметрів конфігурації:

- підключення плагінів Rollup
- вказання сторонніх залежностей, які не слід включати в бандл
- вказання вихідного шляху
- підключати плагіни та пресети Babel

```ts
import { ReteOptions } from 'rete-cli'

export default <ReteOptions>[ // конфігурація з кількома входженнями
  {
    input: 'src/foo/index.ts',
    name: 'Namespace'
    babel: {
      presets: [
        require('@babel/preset-env'), // використовується за замовчуванням, але має бути оголошено, коли ви вказуєте 'presets'
        require('@babel/preset-typescript'), // використовується за замовчуванням
        require('@babel/preset-react'),
      ]
    }
  },
  {
    input: 'src/bar/index.ts',
    name: 'Namespace'
    globals: {
      'rete': 'Rete',
    },
    plugins: [ // вказати Rollup плагіни
      commonjs(),
    ],
    babel: {
      plugins: [
        // включити Babel плагіни
      ]
    }
  }
]
```

### Лінтінг {#lint-rete-cli}

За замовчуванням виконання команди `rete build` включає етап лінтінгу перед генеруванням бандлів. Однак ви також можете виконати лінтінг самостійно, виконавши окрему команду.

```bash
rete lint
```

## Rete Kit {#rete-kit}

Метою цього інструменту є підвищення ефективності розробки плагінів або проектів із використанням цього фреймворку.

Він пропонує такі функції:

- **Створення плагіна**: скористайтеся цією функцією, щоб миттєво створити базову структуру плагіна, без необхідності налаштовування системи збірки, лінтера або тест-раннера
- **Створення додатку**: виберіть фреймворк для створення додатку, вкажіть версію та бажані функції та отримайте готовий до використання додаток, щоб розпочати процес розробки
- **Масова збірка**: виберіть копії репозиторіїв, що містять вихідний код плагінів, що розробляються, і цей інструмент почне їх збірку в режимі спостереження, а також синхронізує їхні залежності

### Встановлення {#install-rete-kit}

```bash
npm i -g rete-kit@next
```

### Створення додатоку {#create-app-rete-kit}

Режим опитувальника

```bash
rete-kit app
```

Або ви можете вказати параметри

```bash
rete-kit app --name <name> --stack <stack> --stack-version <version> --features <features> --deps-alias <deps-alias>
```

де
- `<stack>` параметр дозволяє вибрати між `angular`, `vue`, `vue-vite` або `react`
- `<features>` - це список функцій редактора Rete.js, розділених комами.
- `<deps-alias>` - це файл JSON, який відображає залежності. За замовчуванням інсталюється остання версія з npmjs, але ви можете вказати іншу версію за допомогою формату `name@version` або шляху до архіву

### Створення плагіна {#create-plugin-rete-kit}

Ви можете легко створити плагін у своїй кодовій базі, наслідуючи приклад інших плагінів і розширивши `Scope`, без необхідності створювати його як окремий пакет.

Якщо ви хочете розробити плагін як окремий пакет, скористайтеся цією командою:

```bash
rete-kit plugin --name <plugin name>
```

де `<plugin name>` — це рядок, який буде перетворено в різні формати та використано в шаблонах, наприклад `rete.config.ts` та ім'я `package.json`.

Згенерований плагін містить усі необхідні конфігурації, що дозволяє негайно почати працювати з вихідним кодом.

### Збірка залежностей для розробки {#build-deps-rete-kit}

Розробка модулів, розділених на різні пакети, є складним процесом. На відміну від єдиної кодової бази, де система збірки може виявляти зміни в директорії та застосовувати hot reload, розробникам потрібно вручну налаштувати збірку кожної залежності, над якою вони працюють, і вставити зміни в проект.

По суті, `npm link` і bash скрипти можна використовувати для створення необхідних модулів у режимі спостереження. Однак `npm link` має певні обмеження, які можуть бути не відразу помітні. Ці обмеження можуть походити від спільних залежностей проекту та залежностей, над якими ми працюємо.

Команда `rete-kit build` була створена для вирішення таких проблем. Має два режими:

- **збірка всіх залежностей проекту**: вкажіть шлях вашого проекту. Інструмент сканує поточний каталог рекурсивно (до двох рівнів) на предмет репозиторіїв, які містять залежність `rete`. У режимі спостереження вони безпосередньо збираються в директорію `node_modules`, де вони використовуються
-
```bash
rete-kit build --for ./my-project
```

- **виконання збірки певних директорій**: вкажіть директорії, що містять вихідний код для залежностей, які мають бути включені під час процесу збірки, використовуючи опцію `--folders`. Подібно до першого режиму, отриману збірку буде вставлено в директорію `node_modules` цілі

```bash
rete-kit build --folders my-plugin-1,my-plugin-1,my-project
```

Зверніть увагу, що для повного використання функції hot reload вам потрібно вимкнути кеш для відповідних залежностей. Інакше будь-які внесені зміни не будуть застосовані на льоту. Щоб досягти цього в Webpack, ви можете вказати `snapshot.managedPaths`. Якщо проект усе ще не оновлюється, можливо, потрібно вручну очистити кеш скомпільованих модулів.

## Стайл гайд {#style-guide}

ESLint використовується для забезпечення узгодженості стилю коду в усіх пакетах. Конфігурацію надає [Rete CLI](#rete-cli) і містить правила, які вважаються мейнтейнерами більш підходящими. Якщо необхідно, ви можете налаштувати конфігурацію, додавши потрібні правила

Хоча лінтери корисні, є деякі випадки, які вони можуть пропустити. Щоб доповнити це, ми включили список рекомендацій:

- **Використовуйте коментарі цілеспрямовано**: віддайте пріоритет рефакторингу свого коду, щоб він був більш зрозумілим і лаконічним, перш ніж покладатися на коментарі для його пояснення
- **Простота**: прагніть до балансу між повторним використанням коду та кількістю шаблонного коду. Хоча шаблонний код може здатися зайвим, він часто є більш доцільним, ніж надто складні рішення, які можуть приховати мету коду
- **Обробка помилок і винятків**: завжди належним чином обробляйте помилки та винятки, надаючи користувачам корисну інформацію про проблему. Переконайтеся, що будь-які викинуті винятки не перешкоджають продуктивності програми та витончено обробляються, коли це можливо
- **Продуктивність**: код слід оптимізувати, щоб уникнути значних зависань із великими наборами даних, але не менш важливо підтримувати читабельність коду та легкість обслуговування, а не зосереджуватися виключно на мікрооптимізаціях.
